### 网络基础

#### 输入网址到页面显示的过程

1. DNS查询，将网址解析成服务器的ip（先查浏览器缓存，没有则查DNS）
2. 建立连接（TCP三次握手）
3. 发送HTTP请求
4. 服务器处理请求并响应（根据请求的路径和类型处理请求，然后将相应的资源（通常是HTML文件）以HTTP响应的形式返回给浏览器。）
5. **浏览器渲染页面+执行javascript**：浏览器接收到服务器返回的数据后，会对其进行解析，从HTML到CSS，再到JavaScript，逐步构建DOM（文档对象模型）树；如果页面包含JavaScript代码，浏览器会解析并执行这些代码，可能会修改DOM和CSSOM，甚至是发送新的HTTP请求。这些操作可能会改变页面的外观和行为。
6. **页面显示**：所有的资源都被加载、处理完成后，浏览器会显示最终的页面给用户。

#### Linux系统收发网络包

接收：

1. 收到网卡的硬件中断，交给对应的软中断处理程序
2. 进入网络接口层，检查报文合法性，以及网络层协议（IPv4/IPv6）
3. 进入网络层，查看进一步走向，交给上层还是转发。若IP是自己，查看上层协议是TCP/UDP，去掉IP头，传给传输层。
4. 取出TCP/UDP头，根据四元组找到对应socket，放入socket接收缓冲区。
5. 将内核的socket缓冲区数据拷贝到应用层，唤醒用户进程。



发送：

1. 执行socket系统调用，**内核申请一块sk_buff**，将数据**拷贝**到这块内存中，并**加入发送缓冲区**
2. 协议栈取出缓冲区的sk_buff，按照TCP/IP**协议栈自上至下逐层处理**（一层一层加包头）
3. （TCP）拷贝一个新的sk_buff，以供之后可能的重传使用。
4. 传输层添加TCP包头
5. 网络层选取路由（确认下一跳IP），填充IP头，对超出MTU大小的数据包分片
6. 网络接口层通过ARP协议获取下一跳MAC地址，填充帧头帧尾，将sk_buff添加到网卡发送队列中
7. 通过软中断告知网卡驱动程序，驱动程序把它挂到ringbuffer，ringbuffer中的数据会被映射到网卡可访问内存的DMA，触发真实发送。

只有一个sk_buff:防止不同协议间来回拷贝。

### HTTP

超文本传输协议

超文本：包含文字，图片，视频，超链接（跳转到另一个超文本）

传输：双向

协议：约定和规范。



#### 常见状态码

`1xx` 类状态码属于**提示信息**，是协议处理中的一种中间状态，实际用到的比较少。

`2xx` 类状态码表示服务器**成功**处理了客户端的请求，也是我们最愿意看到的状态。

- 「**200 OK**」是最常见的成功状态码，表示一切正常。如果是非 `HEAD` 请求，服务器返回的响应头都会有 body 数据。
- 「**204 No Content**」也是常见的成功状态码，与 200 OK 基本相同，但响应头没有 body 数据。
- 「**206 Partial Content**」是应用于 HTTP 分块下载或断点续传，表示响应返回的 body 数据并不是资源的全部，而是其中的一部分，也是服务器处理成功的状态。

`3xx` 类状态码表示客户端请求的资源发生了变动，需要客户端用新的 URL 重新发送请求获取资源，也就是**重定向**。

- 「**301 Moved Permanently**」表示永久重定向，说明请求的资源已经不存在了，需改用新的 URL 再次访问。
- 「**302 Found**」表示临时重定向，说明请求的资源还在，但暂时需要用另一个 URL 来访问。

301 和 302 都会在响应头里使用字段 `Location`，指明后续要跳转的 URL，浏览器会自动重定向新的 URL。

- 「**304 Not Modified**」不具有跳转的含义，表示资源未修改，重定向已存在的缓冲文件，也称缓存重定向，也就是告诉客户端可以继续使用缓存资源，用于缓存控制。

`4xx` 类状态码表示客户端发送的**报文有误**，服务器无法处理，也就是错误码的含义。

- 「**400 Bad Request**」表示客户端请求的报文有错误，但只是个笼统的错误。
- 「**403 Forbidden**」表示服务器禁止访问资源，并不是客户端的请求出错。
- 「**404 Not Found**」表示请求的资源在服务器上不存在或未找到，所以无法提供给客户端。

`5xx` 类状态码表示客户端请求报文正确，但是**服务器处理时内部发生了错误**，属于服务器端的错误码。

- 「**500 Internal Server Error**」与 400 类型，是个笼统通用的错误码，服务器发生了什么错误，我们并不知道。
- 「**501 Not Implemented**」表示客户端请求的功能还不支持，类似“即将开业，敬请期待”的意思。
- 「**502 Bad Gateway**」通常是服务器作为网关或代理时返回的错误码，表示服务器自身工作正常，访问后端服务器发生了错误。
- 「**503 Service Unavailable**」表示服务器当前很忙，暂时无法响应客户端，类似“网络服务正忙，请稍后重试”的意思。



#### GET和POST

GET 的语义是请求获取指定的资源。GET 方法是**安全、幂等、可被缓存的。**

POST 的语义是根据请求负荷（报文主体）对指定的资源做出处理，具体的处理方式视资源类型而不同。POST **不安全，不幂等，（大部分实现）不可缓存**。

POST 用 body 传输数据（但通过抓包还是能看到），而 GET 用 URL 传输



#### HTTP缓存

将某些不会变的请求结果，把这对「请求-响应」的数据都**缓存在本地**

##### 强制缓存

只要缓存没过期就用缓存返回。

##### 协商缓存

304：通过服务端告知客户端可以使用缓存

![img](https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/%E7%BD%91%E7%BB%9C/http1.1%E4%BC%98%E5%8C%96/%E7%BC%93%E5%AD%98etag.png)

W